<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <!--<script  src="../greek/js/three71.js"></script>-->
     <script  src="js/three.js"></script>
    <script src="js/jquery-1.12.0.min.js"></script>
    <script src="js/OrbitControls.js"></script>
    <!--<script src="js/FirstPersonControls.js"></script>-->
    <style>
        body{margin: 0px; overflow: hidden;}
    </style>
    <script>
        $( function () {
           /* var clock = new THREE.Clock();*/
            var scene = new THREE.Scene() ;  //加入场景
            var camera = new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1000);  //加入相机，透视投影相机
            camera.position.set(-40,50,20);  //相机定位
            camera.lookAt(new THREE.Vector3(0,0,0));  //相机观看对象
            var renderer = new THREE.WebGLRenderer();  //渲染器
            renderer.setClearColor(new THREE.Color(0x000000,1.0)); //设置清屏颜色
            renderer.setSize(window.innerWidth,window.innerHeight); //设置渲染面积
            renderer.shadowMapEnabled = true;  //开启阴影支持

            //底板纹理
            /*var floorTex = THREE.ImageUtils.loadTexture("img/xg.jpg");
            var plane = new THREE.Mesh(new THREE.BoxGeometry(200,100,0.1,30),new THREE.MeshPhongMaterial({map:floorTex})); //地板3d处理
            plane.position.y = -20.5;
            plane.rotation.x = -0.5 * Math.PI;
            scene.add(plane);*/


            //创建几何体网格
            function createMesh(geometry) {
                var meshMaterial = new THREE.MeshNormalMaterial(); //创建法向材质
                var wireMaterial = new THREE.MeshBasicMaterial(); //创建线材质
                wireMaterial.wireframe = true; //线材质，线帧开启
                return THREE.SceneUtils.createMultiMaterialObject(geometry,[meshMaterial,wireMaterial]); //返回网格对象
            }
            //地球
            var earth = createMesh(new THREE.SphereGeometry(10,50,50,0,2*Math.PI),"img/earth.jpg");
            earth.position.set(0,0,0);
            earth.castShadow = true;//开启对象阴影
           //大气层
            var texture1  = new THREE.ImageUtils.loadTexture('img/earthclouds1k.png');
            var cloudGeometry =  new THREE.SphereGeometry(10.1,50,50,0);
            var cloudMaterial = new THREE.MeshLambertMaterial({
                map:texture1,
                opacity: 1,
                transparent: true
            });
            var cloud = new THREE.Mesh(cloudGeometry,cloudMaterial)
            cloud.position.set(0,0,0);

            //月球
            var moon = createMesh(new THREE.SphereGeometry(2,50,50,0,2*Math.PI),"img/moon.jpg");
            moon.position.set(30,0,30);

            //火星
            var mars = createMesh(new THREE.SphereGeometry(10,50,50,0,2*Math.PI),"img/mars.jpg");
            mars.position.set(0,0,0);


            //创建几何体贴图
            function createMesh(geom,imagefile){
                var texture =THREE.ImageUtils.loadTexture("./"+imagefile); //贴图地址
                geom.computeVertexNormals();  //顶点法线 顶点重新计算
                var mat = new THREE.MeshPhongMaterial(); //创建材质
                mat.map = texture;

                var mesh = new THREE.Mesh(geom,mat);
                return mesh;
            }

            scene.add(earth,moon,cloud,mars); //球面加入到场景

            //skybox
            var path = "img/stars/";
            var format = '.png';
            var urls = [
               path + 'px' + format, path + 'nx' + format,
                path + 'py' + format, path + 'ny' + format,
                path + 'pz' + format, path + 'nz' + format
            ];

            var textureCube = THREE.ImageUtils.loadTextureCube( urls );

            var shader = THREE.ShaderLib[ "cube" ];
            shader.uniforms[ "tCube" ].value = textureCube;

            var material = new THREE.ShaderMaterial( {

                        fragmentShader: shader.fragmentShader,
                        vertexShader: shader.vertexShader,
                        uniforms: shader.uniforms,
                        depthWrite: false,
                        side: THREE.BackSide

                    } ),

            mesh = new THREE.Mesh( new THREE.BoxGeometry( 500, 500, 500 ), material );
            scene.add( mesh );

            //Light
            var spotLight = new THREE.SpotLight(0xffffff); //设置聚光灯光/颜色
            spotLight.position.set(-40,55,-11);  //灯光定位
            scene.add(spotLight); //加入灯光到场景
            scene.add(new THREE.AmbientLight(0x333333)); //加入环境光

            document.body.appendChild(renderer.domElement);
			
			
	createParticles();
	var cloud003;
	function createParticles(){
		
		
			var geom = new THREE.TorusGeometry(10,2,15,70,Math.PI*2);
			var material = new THREE.PointCloudMaterial({
				size:0.1*Math.random(),
				transprent:true,
				opacity:.5,
				//vertexColors:true,
				sizeAttenuation:true,
				color:0xffffff
				});
		 
		 //雪花范围
		 var range = 3;
		 
		 for(var i=0;i<10000;i++){
			 var particle = new THREE.Vector3(
			  Math.random()* range - range / 2 ,
			  
			  Math.random()* range - range / 2,
			  Math.random()* range - range / 2 
			 );
			 geom.vertices.push(particle);
			 var color = new THREE.Color(0xffffff);
			 color.setHSL(color.getHSL().h,color.getHSL().s,Math.random() * color.getHSL().l);
			 geom.colors.push(color);
			 
			 }// for
		 
		 cloud003= new THREE.PointCloud(geom,material);
		 cloud003.name = 'particles';
		 cloud003.rotation.x = -.5 * Math.PI;
		 cloud003.position.x = 34;
		 scene.add(cloud003);
		 
		}//createParticles()
	
			
			
			

            //第一人称控制器
            /*var controls = new THREE.FirstPersonControls(camera);
            controls.lookSpeed = 0.4;
            controls.movementSpeed =  10;
            controls.noFly = false;
            controls.lookVertical = true;
            controls.constraintVerticle = true;
            controls.verticalMax = 2.0;
            controls.verticalMix = 1.0;
            controls.lon = -150;
            controls.lat = 120;*/

            render(); //调用渲染

            //渲染
            var t =0;
			
            function render(){
                t++;
				
                earth.rotation.y += 0.01; //加入旋转
                moon.rotation.y += 0.06;
				// earth.position.set(-2*Math.sin(f/80),0 ,2*Math.cos(f/80));
				earth.position.set(-70*Math.sin(t/90),0 ,70*Math.cos(t/90));
				cloud.position.set(-70*Math.sin(t/90),0 ,70*Math.cos(t/90));
                moon.position.set(-15*Math.sin(t/40) + earth.position.x,0 ,15*Math.cos(t/40) + earth.position.z);
				
                cloud.rotation.y += 0.02;
                mars.rotation.y += 0.005;
               //cloud003.position.x+= 0.01;
		       cloud003.rotation.z+= 50;
			   
			   console.log(earth.position.set);
                /*var delta = clock.getDelta();
                controls.update(delta);*/
                window.requestAnimationFrame(render); //帧动画API
                renderer.render(scene,camera); //调用场景和相机
            }

            //相机控制器
            var controls = new THREE.OrbitControls(camera);
            controls.addEventListener('change');






        } ) ;
    </script>
</head>
<body>

</body>
</html>